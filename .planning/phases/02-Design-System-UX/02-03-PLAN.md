---
phase: 02-Design-System-UX
plan: 03
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/components/booking/SimpleBookingModal.tsx
  - src/components/jobs/QuoteModal.tsx
  - src/components/shared/StepIndicator.tsx
  - e2e/critical-flows-mobile.spec.ts
autonomous: true
requirements: []

must_haves:
  truths:
    - "Vendor registration flow works end-to-end on mobile (375px)"
    - "Event organizer inquiry flow works end-to-end on mobile (375px)"
    - "All form validation errors are visible without scrolling on mobile"
    - "Touch targets in both flows are ≥48px"
  artifacts:
    - path: "src/components/booking/SimpleBookingModal.tsx"
      provides: "Optimized inquiry modal with shadcn Dialog and mobile-first layout"
      min_lines: 100
    - path: "src/components/jobs/QuoteModal.tsx"
      provides: "Optimized quote submission modal with shadcn Dialog"
      min_lines: 80
    - path: "src/components/shared/StepIndicator.tsx"
      provides: "Multi-step form progress indicator"
      exports: ["StepIndicator"]
    - path: "e2e/critical-flows-mobile.spec.ts"
      provides: "E2E tests for vendor registration and organizer inquiry on mobile"
      min_lines: 100
  key_links:
    - from: "src/components/booking/SimpleBookingModal.tsx"
      to: "src/components/ui/dialog.tsx"
      via: "Dialog component import and usage"
      pattern: "import.*Dialog.*from.*@/components/ui/dialog"
    - from: "src/components/booking/SimpleBookingModal.tsx"
      to: "src/components/ui/form.tsx"
      via: "Form components for accessible form fields"
      pattern: "import.*Form.*from.*@/components/ui/form"
    - from: "e2e/critical-flows-mobile.spec.ts"
      to: "src/components/booking/SimpleBookingModal.tsx"
      via: "Tests inquiry modal interaction"
      pattern: "getByRole.*dialog"
---

<objective>
Optimize vendor registration and event organizer inquiry flows for mobile using shadcn/ui components and validate with E2E tests.

Purpose: Implement the optimized designs documented in flow diagrams (02-01) by refactoring SimpleBookingModal and vendor registration flow to use shadcn/ui Dialog, Form, and Input components with mobile-first layouts. Validate both critical flows pass E2E tests on mobile (375px viewport) with proper touch targets, visible validation, and no horizontal scroll.

Output: Mobile-optimized vendor registration + organizer inquiry flows + passing E2E tests
</objective>

<execution_context>
@/Users/toshioj/.claude/get-shit-done/workflows/execute-plan.md
@/Users/toshioj/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-Design-System-UX/02-CONTEXT.md
@.planning/phases/02-Design-System-UX/02-RESEARCH.md
@.planning/phases/02-Design-System-UX/02-01-SUMMARY.md
@docs/flow-diagrams/vendor-registration-flow.md
@docs/flow-diagrams/organizer-inquiry-flow.md
@src/components/booking/SimpleBookingModal.tsx
@src/components/jobs/QuoteModal.tsx
@src/app/(main)/vendors/register/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Optimize SimpleBookingModal (organizer inquiry flow) for mobile</name>
  <files>
    src/components/booking/SimpleBookingModal.tsx
    src/components/shared/StepIndicator.tsx
  </files>
  <action>
    **Part 1: Refactor SimpleBookingModal to use shadcn/ui Dialog**

    Read `src/components/booking/SimpleBookingModal.tsx` and refactor based on flow diagram (organizer-inquiry-flow.md):

    1. **Replace custom modal with shadcn Dialog:**
       - Import: `import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'`
       - Import Form components: `import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form'`
       - Import: `import { Input } from '@/components/ui/input'`
       - Import: `import { Button } from '@/components/ui/button'`
       - Import: `import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'`

    2. **Mobile-friendly Dialog structure:**
       ```tsx
       <Dialog open={open} onOpenChange={setOpen}>
         <DialogTrigger asChild>
           <Button variant="primary">Request Quote</Button>
         </DialogTrigger>

         <DialogContent className="max-w-md sm:max-w-lg w-[calc(100%-2rem)]">
           {/* Sticky header */}
           <DialogHeader className="sticky top-0 bg-white pb-4 border-b z-10">
             <DialogTitle>Request a Quote</DialogTitle>
             <DialogDescription>
               Tell us about your event and we'll connect you with {vendorName}
             </DialogDescription>
           </DialogHeader>

           {/* Scrollable content */}
           <div className="max-h-[60vh] overflow-y-auto py-4">
             <form className="space-y-6" onSubmit={handleSubmit}>
               {/* Form fields here */}
             </form>
           </div>

           {/* Sticky footer */}
           <div className="sticky bottom-0 bg-white pt-4 border-t">
             <Button type="submit" className="w-full" variant="primary">
               Send Inquiry
             </Button>
           </div>
         </DialogContent>
       </Dialog>
       ```

    3. **Mobile-first form layout:**
       - Group related fields in sections with headings:
         - Event Details (event type, date, duration, guest count)
         - Location (address/suburb)
         - Contact Info (name, email, phone)
         - Special Requirements (textarea)

       - Use single-column layout on mobile:
         ```tsx
         <div className="grid grid-cols-1 gap-4">
           <FormItem>
             <FormLabel htmlFor="event-type">Event Type *</FormLabel>
             <FormControl>
               <Select>
                 <SelectTrigger id="event-type">
                   <SelectValue placeholder="Select event type" />
                 </SelectTrigger>
                 <SelectContent>
                   <SelectItem value="wedding">Wedding</SelectItem>
                   <SelectItem value="corporate">Corporate Event</SelectItem>
                   {/* ... more options */}
                 </SelectContent>
               </Select>
             </FormControl>
             <FormMessage>{errors.eventType}</FormMessage>
           </FormItem>

           <FormItem>
             <FormLabel htmlFor="event-date">Event Date *</FormLabel>
             <FormControl>
               <Input id="event-date" type="date" className="w-full" />
             </FormControl>
             <FormMessage>{errors.eventDate}</FormMessage>
           </FormItem>

           {/* Continue for all fields */}
         </div>
         ```

    4. **Form validation improvements:**
       - Move validation logic to client-side validation (show errors immediately below fields)
       - Error messages: text-sm text-red-600, display below input without requiring scroll
       - Required fields marked with asterisk (*) in label
       - Ensure keyboard doesn't hide error messages on mobile (test in E2E)

    5. **Success state:**
       - After submission, replace form content with success message:
         ```tsx
         <div className="text-center py-8">
           <h3 className="text-lg font-semibold text-green-600 mb-2">
             Request Sent Successfully!
           </h3>
           <p className="text-neutral-600 mb-4">
             {vendorName} has been notified of your inquiry.
           </p>
           <p className="text-sm text-neutral-500">
             You should receive a response within 24-48 hours.
           </p>
           <Button onClick={() => setOpen(false)} className="mt-6">
             Close
           </Button>
         </div>
         ```

    6. **Remove inline styles:**
       - Audit for `style={{}}` and replace with Tailwind classes

    **Part 2: Create StepIndicator component (if form becomes multi-step)**

    If SimpleBookingModal is split into 2+ steps (event details → contact info):

    Create `src/components/shared/StepIndicator.tsx`:
    ```tsx
    interface StepIndicatorProps {
      currentStep: number
      totalSteps: number
      steps: string[]  // e.g., ["Event Details", "Contact Info"]
    }

    export function StepIndicator({ currentStep, totalSteps, steps }: StepIndicatorProps) {
      return (
        <div className="flex items-center justify-between mb-6">
          {steps.map((step, index) => (
            <div key={step} className="flex items-center flex-1">
              {/* Step circle */}
              <div className={cn(
                "w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",
                index < currentStep ? "bg-primary-400 text-white" :
                index === currentStep ? "bg-primary-400 text-white" :
                "bg-neutral-200 text-neutral-500"
              )}>
                {index + 1}
              </div>

              {/* Step label (hidden on mobile, shown on tablet+) */}
              <span className="hidden sm:inline ml-2 text-sm text-neutral-600">
                {step}
              </span>

              {/* Connector line */}
              {index < totalSteps - 1 && (
                <div className="flex-1 h-0.5 bg-neutral-200 mx-2" />
              )}
            </div>
          ))}
        </div>
      )
    }
    ```

    Note: For Phase 2, keep SimpleBookingModal as single-step if possible (simpler). Multi-step is optional enhancement.
  </action>
  <verify>
    ```bash
    # Verify SimpleBookingModal imports shadcn Dialog
    grep -E "import.*Dialog.*from.*@/components/ui/dialog" src/components/booking/SimpleBookingModal.tsx

    # Verify mobile-friendly DialogContent classes
    grep -E "max-w-md|w-\[calc\(100%-2rem\)\]|max-h-\[60vh\]" src/components/booking/SimpleBookingModal.tsx

    # Check Form components used
    grep -E "FormItem|FormLabel|FormControl|FormMessage" src/components/booking/SimpleBookingModal.tsx

    # Verify no inline styles
    grep "style={{" src/components/booking/SimpleBookingModal.tsx || echo "No inline styles (good)"

    # Check submit button full-width on mobile
    grep "w-full.*variant=\"primary\"" src/components/booking/SimpleBookingModal.tsx
    ```
  </verify>
  <done>
    - SimpleBookingModal refactored to use shadcn Dialog component
    - DialogContent has mobile sizing: max-w-md sm:max-w-lg w-[calc(100%-2rem)]
    - Form uses FormField pattern with FormLabel, FormControl, FormMessage
    - Single-column layout on mobile (grid-cols-1)
    - Submit button full-width on mobile
    - Success state displays confirmation message with timeline (24-48 hrs)
    - No inline styles; all styling via Tailwind classes
    - StepIndicator component created (if multi-step form implemented)
  </done>
</task>

<task type="auto">
  <name>Optimize QuoteModal and create E2E tests for critical flows</name>
  <files>
    src/components/jobs/QuoteModal.tsx
    e2e/critical-flows-mobile.spec.ts
  </files>
  <action>
    **Part 1: Refactor QuoteModal (job board quote submission)**

    Read `src/components/jobs/QuoteModal.tsx` and apply same mobile optimizations as SimpleBookingModal:

    1. Replace custom modal with shadcn Dialog
    2. Use FormField pattern for all inputs
    3. Mobile-friendly sizing: max-w-md sm:max-w-lg w-[calc(100%-2rem)]
    4. Sticky header/footer, scrollable content (max-h-[60vh])
    5. Full-width submit button on mobile
    6. Success state with confirmation message
    7. Remove inline styles

    Quote form fields (for vendor quote submission):
    - Vendor name (Input)
    - Price per hour (Input type="number")
    - Message/pitch (Textarea)
    - Contact email (Input type="email")

    Use same mobile-first patterns as SimpleBookingModal.

    **Part 2: Create E2E tests for critical flows on mobile**

    Create `e2e/critical-flows-mobile.spec.ts` with comprehensive tests for both flows:

    ```typescript
    import { test, expect, devices } from '@playwright/test'

    // Use mobile viewport (iPhone SE)
    test.use({
      ...devices['iPhone SE'],  // 375x667px
    })

    test.describe('Critical Flows - Mobile (375px)', () => {

      test.describe('Vendor Registration Flow', () => {
        test('Complete vendor registration on mobile', async ({ page }) => {
          await page.goto('/vendors/register')

          // Verify page loads without horizontal scroll
          const bodyWidth = await page.evaluate(() => document.body.scrollWidth)
          const viewportWidth = await page.evaluate(() => window.innerWidth)
          expect(bodyWidth).toBeLessThanOrEqual(viewportWidth)

          // Fill form fields
          await page.getByLabel(/business name/i).fill('Mobile Test Cart')
          await page.getByLabel(/specialty/i).fill('Specialty Coffee')

          // Verify input height ≥48px (touch targets)
          const input = page.getByLabel(/business name/i)
          const inputHeight = await input.evaluate((el) => el.getBoundingClientRect().height)
          expect(inputHeight).toBeGreaterThanOrEqual(48)

          // Test validation: Submit empty required field
          await page.getByLabel(/business name/i).clear()
          await page.getByRole('button', { name: /register|submit/i }).click()

          // Error message should appear and be visible
          const errorMessage = page.getByText(/required/i).first()
          await expect(errorMessage).toBeVisible()

          // Error should be in viewport (not hidden by keyboard)
          const errorBox = await errorMessage.boundingBox()
          expect(errorBox).toBeTruthy()
          if (errorBox) {
            expect(errorBox.y).toBeGreaterThan(0)
            expect(errorBox.y).toBeLessThan(667)  // Viewport height
          }

          // Fill form correctly and submit
          await page.getByLabel(/business name/i).fill('Mobile Test Cart')
          await page.getByLabel(/specialty/i).fill('Specialty Coffee')
          // ... fill remaining required fields

          await page.getByRole('button', { name: /register|submit/i }).click()

          // Success confirmation should appear
          await expect(page.getByText(/success|thank you|registered/i)).toBeVisible({ timeout: 10000 })

          // Success message mentions approval timeline
          await expect(page.getByText(/48.*hours?|approval|review/i)).toBeVisible()
        })

        test('Submit button is full-width on mobile', async ({ page }) => {
          await page.goto('/vendors/register')

          const submitButton = page.getByRole('button', { name: /register|submit/i })
          const buttonWidth = await submitButton.evaluate((el) => el.getBoundingClientRect().width)
          const formWidth = await page.evaluate(() => document.querySelector('form')?.getBoundingClientRect().width || 0)

          // Button should be at least 90% of form width (effectively full-width)
          expect(buttonWidth).toBeGreaterThan(formWidth * 0.9)
        })
      })

      test.describe('Event Organizer Inquiry Flow', () => {
        test('Submit inquiry via SimpleBookingModal on mobile', async ({ page }) => {
          // Navigate to vendor detail page
          await page.goto('/vendors/mobile-cart-specialist')

          // Open inquiry modal
          const requestQuoteButton = page.getByRole('button', { name: /request quote|get.*quote/i })
          await requestQuoteButton.click()

          // Wait for dialog to open
          const dialog = page.getByRole('dialog')
          await expect(dialog).toBeVisible()

          // Verify dialog fits mobile viewport
          const dialogWidth = await dialog.evaluate((el) => el.getBoundingClientRect().width)
          const viewportWidth = await page.evaluate(() => window.innerWidth)
          expect(dialogWidth).toBeLessThanOrEqual(viewportWidth - 32)  // 2rem padding

          // Fill inquiry form
          await dialog.getByLabel(/event type/i).click()
          await page.getByRole('option', { name: /wedding/i }).click()

          await dialog.getByLabel(/event date/i).fill('2026-06-15')
          await dialog.getByLabel(/guest.*count/i).fill('100')
          await dialog.getByLabel(/name/i).fill('Jane Smith')
          await dialog.getByLabel(/email/i).fill('jane@example.com')

          // Verify input touch targets ≥48px
          const emailInput = dialog.getByLabel(/email/i)
          const inputHeight = await emailInput.evaluate((el) => el.getBoundingClientRect().height)
          expect(inputHeight).toBeGreaterThanOrEqual(48)

          // Submit form
          await dialog.getByRole('button', { name: /send.*inquiry|submit/i }).click()

          // Success message appears
          await expect(dialog.getByText(/success|sent|thank you/i)).toBeVisible({ timeout: 10000 })

          // Success message mentions response timeline
          await expect(dialog.getByText(/24.*48.*hours?/i)).toBeVisible()
        })

        test('Dialog content scrollable if form is long', async ({ page }) => {
          await page.goto('/vendors/mobile-cart-specialist')
          await page.getByRole('button', { name: /request quote/i }).click()

          const dialog = page.getByRole('dialog')
          await expect(dialog).toBeVisible()

          // Find scrollable content area
          const scrollableContent = dialog.locator('.overflow-y-auto')
          await expect(scrollableContent).toBeVisible()

          // Verify max-height constraint exists
          const maxHeight = await scrollableContent.evaluate((el) =>
            window.getComputedStyle(el).maxHeight
          )
          expect(maxHeight).toContain('vh')  // Should be viewport-relative (e.g., 60vh)
        })
      })

      test.describe('Mobile UX Requirements', () => {
        test('No horizontal scroll on any critical page', async ({ page }) => {
          const pages = [
            '/',
            '/vendors/register',
            '/vendors/mobile-cart-specialist',
            '/jobs',
          ]

          for (const url of pages) {
            await page.goto(url)

            const bodyWidth = await page.evaluate(() => document.body.scrollWidth)
            const viewportWidth = await page.evaluate(() => window.innerWidth)

            expect(bodyWidth).toBeLessThanOrEqual(viewportWidth + 1,
              `Horizontal scroll detected on ${url}`
            )
          }
        })

        test('All buttons and inputs have ≥48px touch targets', async ({ page }) => {
          await page.goto('/vendors/register')

          // Check all buttons
          const buttons = await page.locator('button').all()
          for (const button of buttons) {
            const height = await button.evaluate((el) => el.getBoundingClientRect().height)
            expect(height).toBeGreaterThanOrEqual(48)
          }

          // Check all inputs
          const inputs = await page.locator('input').all()
          for (const input of inputs) {
            const height = await input.evaluate((el) => el.getBoundingClientRect().height)
            expect(height).toBeGreaterThanOrEqual(48)
          }
        })
      })
    })
    ```

    Run tests to verify:
    ```bash
    npx playwright test e2e/critical-flows-mobile.spec.ts --project="Mobile Chrome"
    ```

    If tests fail, document failures in SUMMARY for follow-up fixes.
  </action>
  <verify>
    ```bash
    # Verify QuoteModal refactored
    grep -E "import.*Dialog.*from.*@/components/ui/dialog" src/components/jobs/QuoteModal.tsx

    # Verify E2E test file created
    ls -la e2e/critical-flows-mobile.spec.ts

    # Run mobile E2E tests
    npx playwright test e2e/critical-flows-mobile.spec.ts --project="Mobile Chrome"

    # Count test cases (should be 7+)
    grep -c "test(" e2e/critical-flows-mobile.spec.ts
    ```
  </verify>
  <done>
    - QuoteModal refactored to use shadcn Dialog with mobile-first layout
    - QuoteModal has sticky header/footer, scrollable content, full-width submit button
    - e2e/critical-flows-mobile.spec.ts created with 7+ test cases
    - Tests cover: vendor registration flow, organizer inquiry flow, touch targets, horizontal scroll, form validation
    - Tests use iPhone SE device profile (375px viewport)
    - Playwright tests executed (failures documented in SUMMARY if any)
  </done>
</task>

</tasks>

<verification>
- SimpleBookingModal uses shadcn Dialog with mobile-friendly sizing (max-w-md, w-[calc(100%-2rem)])
- QuoteModal uses shadcn Dialog with same mobile optimizations
- Both modals have sticky header/footer, scrollable content area
- Form validation errors visible without scrolling on mobile
- E2E tests created for both critical flows (vendor registration, organizer inquiry)
- Mobile tests verify: touch targets ≥48px, no horizontal scroll, validation visibility
- Tests run at 375px viewport (iPhone SE)
</verification>

<success_criteria>
1. SimpleBookingModal imports shadcn Dialog: `grep "from '@/components/ui/dialog'" src/components/booking/SimpleBookingModal.tsx` succeeds
2. QuoteModal imports shadcn Dialog: `grep "from '@/components/ui/dialog'" src/components/jobs/QuoteModal.tsx` succeeds
3. E2E test file exists: `ls e2e/critical-flows-mobile.spec.ts` succeeds
4. Mobile E2E tests pass: `npx playwright test e2e/critical-flows-mobile.spec.ts --project="Mobile Chrome"` shows 7+ passing tests
5. No horizontal scroll verified: Tests check bodyWidth <= viewportWidth on all critical pages
</success_criteria>

<output>
After completion, create `.planning/phases/02-Design-System-UX/02-03-SUMMARY.md`
</output>
